## 1.é¡¹ç›®ç®€ä»‹

### 1.1 åŸºæœ¬ä»‹ç»

- æœ¬é¡¹ç›®æ˜¯åŸºäºPOIæ¡†æ¶ç¼–å†™çš„Excelæ•°æ®å¡«å……å·¥å…·ï¼›
- åŸºäºæ¨¡æ¿å¡«å……æ•°æ®ï¼Œæ“ä½œç®€å•ï¼Œå®¹æ˜“ç†è§£ï¼Œå®¹æ˜“ä¸Šæ‰‹ã€‚



### 1.2 ç‰¹ç‚¹ä¸äº®ç‚¹

> è¿™èŠ‚çœ‹ä¸æ‡‚ğŸ¤£ï¼Ÿæ²¡å…³ç³»ğŸ¤£ï¼Œå…¶å®æˆ‘ä¹Ÿçœ‹ä¸æ‡‚ï¼Œå“ˆå“ˆã€‚
>
> ç›´æ¥çœ‹ç¬¬3èŠ‚å³å¯ã€‚ğŸ¤£



- æ¨¡æ¿å¡«å……

  åªéœ€è¦åœ¨æ¨¡æ¿ä¸­å®šä¹‰è¡¨è¾¾å¼ï¼Œå†å°†æ•°æ®ä¼ ç»™æ¡†æ¶ï¼Œæ¡†æ¶ä¼šæ ¹æ®è¡¨è¾¾å¼çš„å†…å®¹ä¸æ¨¡æ¿å…¬å¼è‡ªåŠ¨å¡«å……æ•°æ®ã€‚

  æ‚¨çš„æ¨¡æ¿å¯ä»¥æ¥è‡ªä»»ä½•åœ°æ–¹ï¼Œå¦‚ï¼šæ–‡ä»¶æœåŠ¡å™¨ã€ossã€æœ¬åœ°æ–‡ä»¶ç­‰ç­‰ã€‚æœ¬æ¡†æ¶å¹¶ä¸å…³å¿ƒæ‚¨çš„æ¨¡æ¿ä»å“ªé‡Œè·å–ã€‚

  æ‚¨çš„æ•°æ®ä¹Ÿå¯ä»¥æ¥è‡ªä»»ä½•åœ°æ–¹ï¼Œå¦‚ï¼šè¿œç¨‹è°ƒç”¨è·å–ã€æ•°æ®åº“è·å–ã€æœ¬åœ°è®¡ç®—äº§ç”Ÿç­‰ã€‚æœ¬æ¡†æ¶åŒæ ·ä¸å…³å¿ƒæ‚¨çš„æ•°æ®ä»ä½•ç§åœ°æ–¹è·å–ã€‚

  æ‚¨åªéœ€è¦æä¾›**sheet**å’Œ**æ•°æ®**å³å¯ã€‚


- æ¨¡æ¿è¡¨è¾¾å¼ä¸°å¯Œ

  æ¨¡æ¿ä¸­çš„è¡¨è¾¾å¼æ”¯æŒå¯¹æ•°æ®çš„ **åŠ å‡ä¹˜é™¤ï¼Œä¸‰ç›®è¿ç®—**æ“ä½œï¼Œæ”¯æŒ**è‡ªå®šä¹‰å‡½æ•°**æ“ä½œ(åœ¨æ„å»ºå¼•æ“æ—¶åŠ å…¥è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå³å¯å†æ¨¡æ¿ä¸­è¿›è¡ŒæŒ‡å‘ï¼Œç¨‹åºä¼š**è‡ªåŠ¨è°ƒç”¨**)ã€‚å®ç°äº†æ•°æ®çš„å¤šå˜æ€§ï¼Œå®ç°äº†æ•°æ®ä¸æ¨¡æ¿çš„è§£è€¦ã€‚


- æ”¯æŒç®€å•ã€**æ•°ç»„**ã€**æ ‘å½¢ç»“æ„**çš„å¡«å……



- æ”¯æŒæ‰©å±•

  å¦‚æœæ¡†æ¶æä¾›çš„æ ‡ç­¾ä¸å¤Ÿæ»¡è¶³æ‚¨çš„ä½¿ç”¨è¦æ±‚ï¼Œæ‚¨è¿˜å¯ä»¥è¿›è¡Œæ‰©å±•ï¼Œè€Œä¸ç”¨æ›´æ”¹ä»»ä½•ä»£ç ã€‚



## 2. åŸºæœ¬åŠŸèƒ½æ¼”ç¤º



### 2.1 åŸºæœ¬ç±»å‹å¡«å……

- æ•°æ®ï¼ˆcardå¯ä»¥**æ˜¯map**ï¼Œä¹Ÿå¯ä»¥**æ˜¯å¯¹è±¡**ï¼Œä¸ºäº†æ–¹ä¾¿å±•ç¤ºï¼Œæ‰€ä»¥è½¬æ¢ä¸ºäº†Jsonï¼‰

  ```json
  {
      "card":{
          "company":"å®¶é‡Œè¹²",
          "email":"zyliu99@foxmail.com",
          "name":"è¿œå­å“¥",
          "phoneNumber":"111000111"
      }
  }
  ```


- æ¨¡æ¿

  ![image-20220228180922673](./md-image/image-20220228180922673.png)

- ç»“æœ(å¯æƒ³è€ŒçŸ¥)

  ![image-20220228181115193](./md-image/image-20220228181115193.png)



### 2.2 æ•°ç»„ç±»å‹å¡«å……

- æ•°æ®ï¼ˆcardå¯ä»¥**æ˜¯map**ï¼Œä¹Ÿå¯ä»¥**æ˜¯å¯¹è±¡**ï¼Œä¸ºäº†æ–¹ä¾¿å±•ç¤ºï¼Œæ‰€ä»¥è½¬æ¢ä¸ºäº†Jsonï¼‰

  ```json
  {
      "classScore":{
          "level":"äº”å¹´çº§ä¸€ç­",
          "name":"æ¸…åxxé™„å±å°å­¦",
          "phone":"15032000000",
          "score":[
              {
                  "chinese":80,
                  "english":30,
                  "math":98,
                  "name":"å¼ ä¸‰"
              },
              {
                  "chinese":70,
                  "english":88,
                  "math":88,
                  "name":"æå››"
              },
              {
                  "chinese":90,
                  "english":90,
                  "math":61,
                  "name":"ç‹äº”"
              },
              {
                  "chinese":86,
                  "english":78,
                  "math":78,
                  "name":"èµµå…­"
              }
          ]
      }
  }
  ```


- æ¨¡æ¿

  ![image-20220711163036603](./md-image/image-20220711163036603.png)

- ç»“æœ(å¯æƒ³è€ŒçŸ¥)

  ![image-20220711163106429](./md-image/image-20220711163106429.png)



### 2.3 æ ‘å½¢ç»“æ„å¡«å……

æ‰€è°“æ ‘å½¢ç»“æ„ï¼Œå°±æ˜¯ä¸Šä¸‹ä¸€æ ·çš„åˆå¹¶èµ·æ¥ï¼Œæ•ˆæœå°±åƒæ˜¯ä¸€ä¸ªæ¨ªç€çš„æ ‘ã€‚

- æ•°æ®ï¼ˆcardå¯ä»¥**æ˜¯map**ï¼Œä¹Ÿå¯ä»¥**æ˜¯å¯¹è±¡**ï¼Œä¸ºäº†æ–¹ä¾¿å±•ç¤ºï¼Œæ‰€ä»¥è½¬æ¢ä¸ºäº†Jsonï¼‰

  ```json
  {
      "contractInfo":{
          "contactName":"liuzy",
          "contactTel":"15020000000"
      },
      "peopleInfo":[
          {
              "cityName":"çŸ³å®¶åº„å¸‚",
              "peopleName":"å¼ ä¸‰",
              "provinceName":"æ²³åŒ—çœ",
              "villageName":"å…¼é¡¾æ‘"
          },
          {
              "cityName":"çŸ³å®¶åº„å¸‚",
              "peopleName":"å¼ ä¸‰",
              "provinceName":"æ²³åŒ—çœ",
              "villageName":"å…¼é¡¾æ‘"
          },
          {
              "cityName":"ä¿å®šå¸‚",
              "peopleName":"æå››2",
              "provinceName":"æ²³åŒ—çœ",
              "villageName":"ç‰›æ‘"
          },
          {
              "cityName":"ä¿å®šå¸‚",
              "peopleName":"æå››3",
              "provinceName":"æ²³åŒ—çœ",
              "villageName":"ç‰›æ‘"
          },
          {
              "cityName":"æµ·æ·€åŒº",
              "peopleName":"é£",
              "provinceName":"åŒ—äº¬å¸‚",
              "villageName":"å‰å®³æ‘"
          },
          {
              "cityName":"æœé˜³åŒº",
              "peopleName":"æ‰½ç»™",
              "provinceName":"åŒ—äº¬å¸‚",
              "villageName":"ç‰›é€¼æ‘"
          }
      ]
  }
  ```


- æ¨¡æ¿

  ![image-20220711170253974](./md-image/image-20220711170253974.png)

- ç»“æœ

  ![image-20220711170324729](./md-image/image-20220711170324729.png)



### 2.4 è¡¨è¾¾å¼è®¡ç®—

åœ¨æ¨¡æ¿ä¸­é™¤äº†æ”¯æŒæ™®é€šçš„å˜é‡å£°æ˜ä¹‹å¤–ï¼Œè¿˜æ”¯æŒå„ç§åŸºæœ¬çš„è¿ç®—ã€‚

æ¯”å¦‚åŠ å‡ä¹˜é™¤ï¼Œä¸‰ç›®è¿ç®—ç­‰ç­‰ä¸€äº›åŸºæœ¬çš„è¿ç®—ã€‚

ä¸‹é¢æˆ‘ä»¬ä»¥ä¸Šè¿° **åˆ†æ•°çš„æ¡ˆä¾‹**çš„åŸºç¡€ä¸Šä½¿**ç”¨ä¸‰ç›®è¿ç®—ç¬¦æ¥è¿›è¡Œä¸¾ä¾‹ã€‚**

å…·ä½“éœ€æ±‚ä¸ºï¼š

- å½“åˆ†æ•°å¤§äºç­‰äº60æ—¶æˆ‘ä»¬æ˜¾ç¤ºåŠæ ¼
- å½“åˆ†æ•°å°äº60æ—¶æˆ‘ä»¬æ˜¾ç¤ºä¸åŠæ ¼

åœ¨æ•°æ®ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ”¹å˜æ¨¡æ¿ï¼Œåœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ä¸‰ç›®è¿ç®—ç¬¦....

æ¨¡æ¿å¦‚ä¸‹ï¼š

![image-20220711172722301](./md-image/image-20220711172722301.png)

åŒæ ·æ•°æ®çš„å¡«å……ç»“æœå¦‚ä¸‹ï¼š

![image-20220711172820283](./md-image/image-20220711172820283.png)



### 2.5 è‡ªå®šä¹‰å‡½æ•°

æœ‰æ—¶å€™ï¼Œå¯èƒ½å•ä¸€çš„ã€ç®€å•çš„è¿ç®—å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„å‡½æ•°æ¥å¯¹å¡«å……çš„å˜é‡åšä¸€ä¸‹å¤æ‚çš„å¤„ç†ã€‚

éœ€æ±‚å¦‚ä¸‹ï¼šå½“åˆ†æ•°ï¼š

- \>= 90 æ˜¾ç¤ºä¼˜ç§€
- \>= 80 æ˜¾ç¤ºè‰¯å¥½
- \>= 60 æ˜¾ç¤ºå°šå¯
- å…¶ä»–æƒ…å†µï¼Œæ˜¾ç¤ºä¸åŠæ ¼

ä¸‹é¢æˆ‘ä»¬å°±æ¼”ç¤ºä¸€ä¸‹ä½¿ç”¨å¦‚ä½•åˆ©ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š

1. ç¼–å†™è‡ªå®šä¹‰å‡½æ•°

   ```java
   /**
    * @author immort-liuzyj(zyliu)
    * @since 2022/7/12  9:20
    */
   public class ScoreUtil {
   
       /**
        * åˆ†æ•°æ ¼å¼åŒ–æ–¹æ³•
        *
        * @param score åˆ†æ•°
        * @return æ ¼å¼åŒ–åçš„ç»“æœ
        */
       public static String formatScore(double score) {
   
           String evaluation;
   
           if (score >= 90) {
               evaluation = "ä¼˜ç§€";
           } else if (score >= 80) {
               evaluation = "è‰¯å¥½";
           } else if (score >= 60) {
               evaluation = "å°šå¯";
           } else {
               evaluation = "ä¸åŠæ ¼";
           }
           return evaluation;
       }
   }
   ```

2. æ³¨å†Œå…¨å±€å‡½æ•°

   **å®ç°å‡½æ•°æä¾›è€…**

   ```java
   /**
    * @author immort-liuzyj(zyliu)
    * @since 2022/7/11  17:52
    * å‡½æ•°æä¾›è€…
    */
   public class MyFunctionProvider3 implements FunctionProvider {
   
   
       /**
        * æä¾›function
        *
        */
       @Override
       public Map<String, Object> provideFunctions() {
           Map<String, Object> res = new HashMap<>();
           res.put("Lists", Lists.class);
           // æ³¨å†Œåˆ°å…¨å±€
           res.put("ScoreUtil", ScoreUtil.class);
           return res;
       }
   }
   ```

   **ä½¿ç”¨SPIæœºåˆ¶æ³¨å†Œï¼š**

   ![image-20220712133208210](./md-image/image-20220712133208210.png)

3. åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å‡½æ•°

   ä½¿ç”¨å‡½æ•°æ—¶çš„æ ¼å¼ä¸ºï¼š**æ³¨å†Œçš„åç§° + å†’å· + é™æ€æ–¹æ³•åç§°**

   ![image-20220712133337031](./md-image/image-20220712133337031.png)


å¯¼å‡ºç»“æœå¦‚ä¸‹ï¼š

![image-20220712133502784](./md-image/image-20220712133502784.png)






## 3. é¡¹ç›®è¯¦ç»†ä½¿ç”¨



### 3.1 ä»£ç æ¼”ç¤º

#### 3.1.1 åˆ›å»ºâ€œå¡«å……è€…â€

```java
private TemplateExcelFiller templateExcelFiller;

public void init() {

    // æ„å»ºå¯¼å‡ºè€…
    templateExcelFiller = TemplateExcelFillerFactory
        .defaultTemplateExcelFillerBuilder()
        // ä¸‹é¢è¿˜æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œè‡ªå·±å»ç‚¹ã€‚
        // ä¸è¿‡è™½ç„¶æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œä½†æ˜¯ç”¨ä¸åˆ°ã€‚
        // æˆ‘ä»¬éƒ½æä¾›äº†ç›¸å…³çš„æ‰©å±•ç‚¹
        .expressionCacheSize(500)
        .build();

}

```



#### 3.1.2 å‡†å¤‡æ•°æ®ä¸æ¨¡æ¿

- å‡†å¤‡æ•°æ®(ä½ çš„æ•°æ®å¯ä»¥æ¥è‡ªä»»ä½•åœ°æ–¹ï¼Œä¸‹é¢åªæ˜¯ä¸¾ä¸€ä¸ªä¾‹å­è€Œå·²)

  ```java
  /**
    * åˆå§‹åŒ–æ•°æ®ï¼Œå¯ä»¥æ˜¯pojoç±»ï¼Œæˆ–è€…æ˜¯mapç­‰ã€‚
    *
    * @return å‡†å¤‡è¦å¡«å……çš„æ•°æ®
    */
  private Map<String, Object> initParam() {


      Map<String, Object> res = new HashMap<>();
      ClassScore classScore = new ClassScore();
      res.put("classScore", classScore);

      classScore.setName("æ¸…åxxé™„å±å°å­¦");
      classScore.setLevel("äº”å¹´çº§ä¸€ç­");
      classScore.setPhone("15032000000");

      List<ClassScore.Score> scoreList = new ArrayList<>();
      scoreList.add(new ClassScore.Score("å¼ ä¸‰", 80D, 98D, 30D));
      scoreList.add(new ClassScore.Score("æå››", 70D, 88D, 88D));
      scoreList.add(new ClassScore.Score("ç‹äº”", 90D, 61D, 90D));
      scoreList.add(new ClassScore.Score("èµµå…­", 86D, 78D, 78D));

      classScore.setScore(scoreList);
      return res;


  }
  ```



- å‡†å¤‡Excelæ¨¡æ¿

  ![1662355660079](./assets/1662355660079.png)

#### 3.1.3 ä½¿ç”¨â€œå¡«å……è€…â€å¯¹è±¡å¡«å……Excel

è°ƒç”¨æ–¹æ³•è¿›è¡Œå¡«å……

```java
@Test
public void test() throws IOException, InvalidFormatException {

    Map<String, Object> param = initParam();

    //è·å–æ–‡ä»¶çš„URL
    URL url = this.getClass()
        .getClassLoader()
        .getResource("05MyScore_function.xlsx");
    assert url != null;

    // å‡†å¤‡workbook
    Workbook workbook = new XSSFWorkbook(new File(url.getPath()));
    Sheet sheet = workbook.getSheetAt(0);


    // è°ƒç”¨å¡«å……è€…æ¥å¡«å……æ•°æ®
    templateExcelFiller.fillData(() -> sheet, () -> param);

    // å°†Excel å†™å‡ºå»ï¼ŒæŸ¥çœ‹ç»“æœ
    ExcelUtil.writeFile(
        workbook, 
        new File("C:\\Users\\immortal\\Desktop\\05MyScore_functionxxxx.xlsx")
    );
}
```



**å…¶å®æ ¸å¿ƒä»£ç å°±æ˜¯ä¸€å¥ï¼šï¼ˆæä¾›æ¨¡æ¿çš„sheetå¯¹è±¡å’Œå‚æ•°å¯¹è±¡å³å¯ã€‚ï¼‰**

```java
templateExcelFiller.fillData(() -> sheet, () -> param);
// ä¹Ÿå¯ä»¥è¿™æ ·ï¼š
templateExcelFiller.fillData(sheet, param);
```



### 3.2 Spring-Boot æ•´åˆ





### 3.3 Springæ•´åˆ



## 4. é¡¹ç›®æ‰©å±•

> é‡‡ç”¨SPIæœºåˆ¶è¿›è¡Œæ‰©å±•

### 4.1 æ‰©å±•å¤„ç†å•å…ƒæ ¼çš„handler



#### 4.1.1 ç»§æ‰¿æŠ½è±¡ç±»/å®ç°æ¥å£  

>ä¸‹é¢ä¼šæœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œæ‚¨å¯è‡ªç”±é€‰æ‹©ã€‚ä¸‹é¢ä¸ä¼šæœ‰è¿‡å¤šçš„èµ˜è¿°ï¼Œæ‚¨ç›´æ¥çœ‹æ–¹æ³•çš„æ³¨é‡Šå³å¯æ˜ç™½ã€‚

##### 4.1.1.1 æŠ½è±¡ç±»

æŠ½è±¡ç±»æ˜¯å¯¹æ¥å£çš„æŠ½è±¡ã€‚å¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨æŠ½è±¡ç±»æ‰©å±•ï¼Œæ‚¨å¯ä»¥æ³¨é‡æ‚¨çš„é€»è¾‘ï¼Œè€Œä¸ç”¨å…³å¿ƒä¸€äº›ç»†ææœ«èŠ‚çš„ä¸œè¥¿ã€‚å› ä¸ºExcelçš„å•å…ƒæ ¼è§£æã€å†…å®¹æŠ½å–å·²ç»åœ¨æŠ½è±¡ç±»ä¸­åšäº†ï¼Œæ‚¨åªéœ€è¦ç»§æ‰¿æŠ½è±¡ç±»å»å®Œæˆå‰©ä½™çš„æ–¹æ³•å³å¯ã€‚



![1660714037395](./md-image/1660714037395.png)


##### 4.1.1.2 æ¥å£

ä½¿ç”¨æ¥å£æ‰©å±•ï¼Œæ‚¨å¯ä»¥ä»Excelå•å…ƒæ ¼å†…å®¹è§£æå¼€å§‹åšï¼Œå¯è‡ªå·±å¤„ç†çš„ä¸œè¥¿å˜å¤šã€‚

![1660714098337](./md-image/1660714098337.png)

#### 4.1.1 SPIæœºåˆ¶å£°æ˜

- **åœ¨classpathä¸‹åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶ï¼š**

  ![1660714382059](./md-image/1660714382059.png)

- **åœ¨æ–‡ä»¶ä¸­å°†è‡ªå·±æ‰©å±•çš„ç±» çš„å…¨é™å®šç±»åæ”¾å…¥æ–‡ä»¶ä¸­**![1660714432165](./md-image/1660714432165.png)



### 4.2 æ‰©å±•å¡«å……å®Œæˆä¹‹åçš„å¤„ç†å™¨

- å®ç°æ­¤æ¥å£![1660714498561](./md-image/1660714498561.png)

- ä½¿ç”¨SPIæœºåˆ¶å£°æ˜

  è¿™é‡Œå‚è€ƒä¸Šé¢å³å¯ã€‚



### 4.3 æ³¨å†Œå…¨å±€å‡½æ•°

- å®ç°ä¸‹é¢çš„æ¥å£

  ![1662354373139](./md-image/1662354373139.png)

  ç¤ºä¾‹å¦‚ä¸‹:

  ![1662354471315](./md-image/1662354471315.png)

- ä½¿ç”¨SPIæœºåˆ¶å£°æ˜å³å¯

  åœ¨classpathä¸‹æ–°å»ºæ–‡ä»¶`/META-INF/services/pers.lzy.template.excel.core.FunctionProvider`ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸‹å¡«å……å¯¹åº”ç±»çš„å…¨é™å®šç±»åå³å¯ã€‚

  ![1662354674517](./md-image/1662354674517.png)

  â€‹




## 5.è”ç³»æˆ‘
- `email`:  **zyliu99@foxmail.com**





## 6. å¼€æºåè®®

[Apache 2.0](./LICENSE) Â© immort-zyliu







